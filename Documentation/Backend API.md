# Backend API

Backend provides Flask API for managing the surveys stored in the PostgreSQL database.

## API endpoints

| URI                       | METHOD |  DESCRIPTION                                                                                                                                                                                                                                                                                                                                                          | AUTHENTICATION REQUIRED  |
| ------------------------- | ------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------ |
| /                         | GET    | **If not authenticated** displays google login page. **If authenticated** show existing surveys where `surveys (list)` contains `survey id (int), title (str), question count (int), submission count (int), survey status (list)`.<br /><br />The list `survey status` contains `status (str)`, `no_survey_results (bool)`, `no_categories (bool)`, `unrelated_categories_in_weights (list of str)`, `no_questions (bool)`, `questions_without_answers (list of str)`, `questions_without_categories (list of str)`, `categories_without_questions (list of str)`, `categories_without_results (dict [question id: category name])`.   |  Yes/No                  |
| /google_login             | POST   | Authenticates Google SSO login and checks if the `email (str)` has access to the service. |  No                      |
| /logout                   | POST   | Terminates the current session and logs the user out of the system. |  Yes                     |
| /admins                   | GET    | Fetches the current authorized `admins (list)` containing tuples with the `id (str), email (str)`. |  Yes                     |
| /admins/new               | POST   | Adds the given `email (str)` to the database table of authorized users |  Yes                     |
| /logs                     | GET    | View `event_logs (list)` containing `username (str), filename (str), log_requests (str), sensitive (str)`. |  No                      |
| /logs/oldestfirst         | GET    | Same view as `/logs` with the events reversed by entry time. |  Yes                      |
| /surveys/new-survey       | GET    | Display the page for creating a new survey. |  Yes                      |
| /surveys/new-survey       | POST   | Insert the new survey with details `name (str)`, `title (str)`, `survey (str)` to the database. |  Yes                      |
| /surveys/<survey_id>/edit | GET    | Display the `survey (list)` containing `id (int), name (str), createdAt (timestamptz), updatedAt (timestamptz), title_text (str), survey_text (str)`. |  Yes                      |
| /surveys/<survey_id>/edit | POST   | Update the survey with the `survey_id (int)` to the database to match `name (str)`, `title (str)`, `description (str)`. |  Yes                      |
| /surveys/<survey_id>/delete-survey | POST   | Delete the survey with the `survey_id (int)` from the database after user enters the `confirmation_text (str)`. |  Yes                      |
| /surveys/<survey_id>      | GET    | View the details for the survey with `survey_id (int)`.<br /><br />Show `survey (list)` containing `id (int), name (str), createdAt (timetz), updatedAt (timetz), title_text (str), survey_text (str)`.<br /><br />Show the `questions (list)` containing `id (int), text (str), surveyId (int), category_weights (json), createdAt (timestamptz), updatedAt (timestamptz)`.<br /><br />Show the `categories (list)` containing `id (int), name (str), description (str), content_links (json)`.<br /><br />Show `results (list)` containing `id (int), text (str), cutoff_from_maxpoints (float)`.<br /><br />Show `show_results (list of str)`.<br /><br />Show `survey_status (list)` containing `status (str)`, `no_survey_results (bool)`, `no_categories (bool)`, `unrelated_categories_in_weights (list of str)`, `no_questions (bool)`, `questions_without_answers (list of str)`, `questions_without_categories (list of str)`, `categories_without_questions (list of str)`, `categories_without_results (dict [question id: category name])`. |  Yes                      |
| /surveys/<survey_id>/new-question | GET    | Display the page for creating a new question.<br /><br />Show existing `categories (list)` containing `id (int), name (str), description (str), content_links (json)`.<br /><br />Passed variables:<br /><br />`survey (list)` containing `id (int), name (str), createdAt (timetz), updatedAt (timetz), title_text (str), survey_text (str)`,<br /><br />`weights (dict)`.|  Yes                      |
