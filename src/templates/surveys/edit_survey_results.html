{% extends "layout.html" %}
{% import "components/macros/form_elements.html" as form_elements %}
{% import "components/macros/survey_elements.html" as survey_elements %}
{% import "components/macros/tooltip.html" as tooltip %}
{% import "components/macros/buttons.html" as buttons %}

{% block content %}
<div class="flex justify-between">
    <h1 class="text-slate-700">Add a result to {{ survey.name }}</h1>
</div>
{{ buttons.link_button("Back to survey", "/surveys/%s" % survey[0]) }}
<div class="flex flex-col gap-6 items-start w-full">
    <form class="w-full" action="/surveys/{{ survey.id }}/new-survey-result" method="POST">
        <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
        <input type="hidden" name="survey_id" id="survey_id" value="{{ survey.id }}">
        <div class="grid grid-cols-2 gap-4">
            <div class="flex flex-col gap-6">
                {% call survey_elements.card() %}
                <div class="flex flex-col gap-4">
                    <div class="flex flex-col gap-2 w-full">
                        {% set upper_bound = 1.0 %}
                        {% if first %}
                            {% set lower_bound = 1.0 %}
                        {% else %}    
                            {% set lower_bound = 0.0 %}
                        {% endif %}
                            {{ form_elements.label("text", "Result text") }}
                            {{ form_elements.text_area("text", "Result", "Your skills in this topic are excellent!", true, text) }}
                            {{ form_elements.label("cutoff", "Cutoff from maximum points") }}
                            {{ form_elements.number_input("cutoff", "new-cutoff", "Cutoff from max points", 1.0, true, lower_bound, upper_bound, 0.01, 1.0) }}
                    </div>
                    {{ form_elements.submit_button("Save changes") }}
                </div>
                {% endcall %}
                {% if results|length == 1 %}
                {{ survey_elements.survey_result_card(results[0], 0, hide_delete_button=True) }}
                {% else %}
                {% for result in results %}
                {{ survey_elements.survey_result_card(result, loop.index) }}
                {% endfor %}
                {% endif %}
            </div>
        </div>
    </form>
</div>
{% endblock %}
